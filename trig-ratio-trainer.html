<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trig Ratio Trainer</title>
  <style>
    :root {
      --bg-1: #f7efe4;
      --bg-2: #d8e8f2;
      --ink: #1e2430;
      --card: #ffffffcc;
      --accent: #c84f2c;
      --accent-2: #1f6f8b;
      --ok: #1f8a5b;
      --bad: #b33a3a;
      --muted: #4f5d75;
      --shadow: 0 16px 40px rgba(0, 0, 0, 0.12);
      --radius: 18px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Avenir Next", "Gill Sans", "Trebuchet MS", sans-serif;
      color: var(--ink);
      background:
        radial-gradient(circle at 15% 20%, #fff6d8 0%, transparent 35%),
        radial-gradient(circle at 85% 85%, #d7f4ff 0%, transparent 35%),
        linear-gradient(130deg, var(--bg-1), var(--bg-2));
      display: grid;
      place-items: center;
      padding: 20px;
    }

    .app {
      width: min(920px, 100%);
      background: var(--card);
      border: 1px solid #ffffff;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
      padding: 24px;
      animation: lift-in 450ms ease;
    }

    @keyframes lift-in {
      from {
        opacity: 0;
        transform: translateY(12px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    h1 {
      margin: 0;
      font-size: clamp(1.5rem, 3vw, 2.1rem);
      letter-spacing: 0.02em;
      font-weight: 700;
    }

    .subtitle {
      margin-top: 6px;
      margin-bottom: 20px;
      color: var(--muted);
      font-size: 0.98rem;
    }

    .layout {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }

    .panel {
      background: #ffffffd4;
      border: 1px solid #f0f0f0;
      border-radius: 14px;
      padding: 14px;
    }

    .label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #5d6776;
      margin-bottom: 10px;
      font-weight: 700;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .choice {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid #d9dde2;
      background: #fff;
      font-size: 0.95rem;
    }

    .question-wrap {
      padding: 20px;
      text-align: center;
      border-radius: 14px;
      background: linear-gradient(145deg, #fff, #f7fafc);
      border: 1px solid #e8edf3;
    }

    .question {
      font-size: clamp(1.5rem, 4vw, 2.2rem);
      font-weight: 700;
      margin: 0;
      letter-spacing: 0.01em;
    }

    .answer {
      margin-top: 14px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      align-items: center;
    }

    input[type="text"] {
      width: min(360px, 100%);
      padding: 12px 14px;
      border: 1px solid #c9d2db;
      border-radius: 10px;
      font-size: 1rem;
      outline: none;
      transition: border-color 180ms ease, box-shadow 180ms ease;
      font-family: "Avenir Next", "Gill Sans", "Trebuchet MS", sans-serif;
    }

    input[type="text"]:focus {
      border-color: var(--accent-2);
      box-shadow: 0 0 0 3px #1f6f8b22;
    }

    button {
      border: none;
      border-radius: 10px;
      padding: 11px 14px;
      font-size: 0.94rem;
      font-weight: 700;
      cursor: pointer;
      transition: transform 120ms ease, filter 120ms ease;
    }

    button:hover {
      transform: translateY(-1px);
      filter: brightness(1.03);
    }

    button:active {
      transform: translateY(0);
    }

    .primary {
      background: var(--accent);
      color: #fff;
    }

    .secondary {
      background: var(--accent-2);
      color: #fff;
    }

    .ghost {
      background: #eef3f7;
      color: #223043;
    }

    .feedback {
      min-height: 1.5em;
      text-align: center;
      margin-top: 12px;
      font-weight: 700;
    }

    .feedback.ok {
      color: var(--ok);
    }

    .feedback.bad {
      color: var(--bad);
    }

    .feedback.neutral {
      color: #5f6775;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-top: 8px;
    }

    .stat {
      background: #fff;
      border: 1px solid #edf0f4;
      border-radius: 12px;
      padding: 12px;
      text-align: center;
    }

    .stat .k {
      color: #5e6d7f;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 700;
    }

    .stat .v {
      margin-top: 4px;
      font-size: 1.35rem;
      font-weight: 700;
    }

    .answer-key {
      margin-top: 8px;
      text-align: center;
      color: #3d4b5f;
      font-size: 0.92rem;
      min-height: 1.2em;
    }

    .tip {
      margin-top: 14px;
      color: #47566d;
      font-size: 0.89rem;
      line-height: 1.4;
      text-align: center;
    }

    @media (max-width: 640px) {
      .app {
        padding: 16px;
      }

      .stats {
        grid-template-columns: 1fr;
      }

      .answer {
        flex-direction: column;
      }

      button {
        width: min(360px, 100%);
      }
    }
  </style>
</head>
<body>
  <main class="app">
    <h1>Trig Ratio Trainer</h1>
    <p class="subtitle">Practice exact trig values for special angles and their multiples.</p>

    <section class="layout">
      <div class="panel">
        <div class="label">Settings</div>
        <div class="row" style="margin-bottom: 10px;">
          <label class="choice"><input type="radio" name="unit" value="degrees" checked /> Degrees</label>
          <label class="choice"><input type="radio" name="unit" value="radians" /> Radians</label>
          <label class="choice"><input id="extended-toggle" type="checkbox" checked /> Include negative and multi-turn multiples</label>
        </div>
        <div class="row" id="ratio-choices"></div>
      </div>

      <div class="question-wrap">
        <p class="question" id="question-text">sin(30°)</p>
        <div class="answer">
          <input id="answer-input" type="text" autocomplete="off" placeholder="Type exact value (e.g., -√3/2, 2/√3, undefined)" />
          <button class="primary" id="check-btn">Check</button>
          <button class="ghost" id="show-btn">Show Answer</button>
          <button class="secondary" id="next-btn">Next</button>
        </div>
        <div id="feedback" class="feedback neutral"></div>
        <div id="answer-key" class="answer-key"></div>
        <p class="tip">Accepted input examples: <strong>√3/2</strong>, <strong>1/sqrt(3)</strong>, <strong>2*sqrt(3)/3</strong>, <strong>undefined</strong></p>
      </div>

      <div class="panel">
        <div class="label">Stats</div>
        <div class="stats">
          <div class="stat"><div class="k">Correct</div><div class="v" id="correct-count">0</div></div>
          <div class="stat"><div class="k">Attempts</div><div class="v" id="attempt-count">0</div></div>
          <div class="stat"><div class="k">Streak</div><div class="v" id="streak-count">0</div></div>
        </div>
      </div>
    </section>
  </main>

  <script>
    const ratios = ["sin", "cos", "tan", "csc", "sec", "cot"];
    const oneTurnAngles = [0, 30, 45, 60, 90, 120, 135, 150, 180, 210, 225, 240, 270, 300, 315, 330, 360];

    const valueTable = {
      0:   { sin: "0",      cos: "1",      tan: "0",        csc: "undefined", sec: "1",        cot: "undefined" },
      30:  { sin: "1/2",    cos: "√3/2",   tan: "1/√3",     csc: "2",         sec: "2/√3",     cot: "√3" },
      45:  { sin: "√2/2",   cos: "√2/2",   tan: "1",        csc: "√2",        sec: "√2",       cot: "1" },
      60:  { sin: "√3/2",   cos: "1/2",    tan: "√3",       csc: "2/√3",      sec: "2",        cot: "1/√3" },
      90:  { sin: "1",      cos: "0",      tan: "undefined",csc: "1",         sec: "undefined",cot: "0" },
      120: { sin: "√3/2",   cos: "-1/2",   tan: "-√3",      csc: "2/√3",      sec: "-2",       cot: "-1/√3" },
      135: { sin: "√2/2",   cos: "-√2/2",  tan: "-1",       csc: "√2",        sec: "-√2",      cot: "-1" },
      150: { sin: "1/2",    cos: "-√3/2",  tan: "-1/√3",    csc: "2",         sec: "-2/√3",    cot: "-√3" },
      180: { sin: "0",      cos: "-1",     tan: "0",        csc: "undefined", sec: "-1",       cot: "undefined" },
      210: { sin: "-1/2",   cos: "-√3/2",  tan: "1/√3",     csc: "-2",        sec: "-2/√3",    cot: "√3" },
      225: { sin: "-√2/2",  cos: "-√2/2",  tan: "1",        csc: "-√2",       sec: "-√2",      cot: "1" },
      240: { sin: "-√3/2",  cos: "-1/2",   tan: "√3",       csc: "-2/√3",     sec: "-2",       cot: "1/√3" },
      270: { sin: "-1",     cos: "0",      tan: "undefined",csc: "-1",        sec: "undefined",cot: "0" },
      300: { sin: "-√3/2",  cos: "1/2",    tan: "-√3",      csc: "-2/√3",     sec: "2",        cot: "-1/√3" },
      315: { sin: "-√2/2",  cos: "√2/2",   tan: "-1",       csc: "-√2",       sec: "√2",       cot: "-1" },
      330: { sin: "-1/2",   cos: "√3/2",   tan: "-1/√3",    csc: "-2",        sec: "2/√3",     cot: "-√3" }
    };

    const canonicalToNumber = {
      "0": 0,
      "1": 1,
      "-1": -1,
      "1/2": 0.5,
      "-1/2": -0.5,
      "√2/2": Math.SQRT2 / 2,
      "-√2/2": -Math.SQRT2 / 2,
      "√3/2": Math.sqrt(3) / 2,
      "-√3/2": -Math.sqrt(3) / 2,
      "1/√3": 1 / Math.sqrt(3),
      "-1/√3": -1 / Math.sqrt(3),
      "√3": Math.sqrt(3),
      "-√3": -Math.sqrt(3),
      "√2": Math.SQRT2,
      "-√2": -Math.SQRT2,
      "2": 2,
      "-2": -2,
      "2/√3": 2 / Math.sqrt(3),
      "-2/√3": -2 / Math.sqrt(3)
    };

    const els = {
      questionText: document.getElementById("question-text"),
      answerInput: document.getElementById("answer-input"),
      checkBtn: document.getElementById("check-btn"),
      showBtn: document.getElementById("show-btn"),
      nextBtn: document.getElementById("next-btn"),
      feedback: document.getElementById("feedback"),
      answerKey: document.getElementById("answer-key"),
      correctCount: document.getElementById("correct-count"),
      attemptCount: document.getElementById("attempt-count"),
      streakCount: document.getElementById("streak-count"),
      ratioChoices: document.getElementById("ratio-choices"),
      extendedToggle: document.getElementById("extended-toggle")
    };

    const state = {
      correct: 0,
      attempts: 0,
      streak: 0,
      question: null
    };

    function gcd(a, b) {
      let x = Math.abs(a);
      let y = Math.abs(b);
      while (y) {
        const t = y;
        y = x % y;
        x = t;
      }
      return x || 1;
    }

    function degToRadLabel(deg) {
      if (deg === 0) return "0";
      let n = deg;
      let d = 180;
      const g = gcd(n, d);
      n /= g;
      d /= g;

      if (d === 1) {
        if (n === 1) return "π";
        if (n === -1) return "-π";
        return `${n}π`;
      }

      if (n === 1) return `π/${d}`;
      if (n === -1) return `-π/${d}`;
      return `${n}π/${d}`;
    }

    function normalizeAngle(deg) {
      const normalized = ((deg % 360) + 360) % 360;
      return normalized === 360 ? 0 : normalized;
    }

    function getSelectedRatios() {
      return [...document.querySelectorAll('input[name="ratio"]:checked')].map((el) => el.value);
    }

    function randomItem(list) {
      return list[Math.floor(Math.random() * list.length)];
    }

    function formatAngle(deg, unit) {
      if (unit === "degrees") return `${deg}°`;
      return degToRadLabel(deg);
    }

    function createQuestion() {
      const selected = getSelectedRatios();
      if (!selected.length) {
        state.question = null;
        els.questionText.textContent = "Select at least one ratio to continue.";
        setFeedback("Choose one or more trig ratios.", "neutral");
        els.answerKey.textContent = "";
        return;
      }

      const includeExtended = els.extendedToggle.checked;
      const base = randomItem(oneTurnAngles);
      const turn = includeExtended ? (Math.floor(Math.random() * 7) - 3) : 0;
      const angle = base + turn * 360;
      const normalized = normalizeAngle(angle);

      const ratio = randomItem(selected);
      const canonical = valueTable[normalized][ratio];
      const answerNumber = canonical === "undefined" ? null : canonicalToNumber[canonical];

      const unit = document.querySelector('input[name="unit"]:checked').value;
      const angleLabel = formatAngle(angle, unit);

      state.question = {
        angle,
        normalized,
        ratio,
        unit,
        canonical,
        answerNumber
      };

      els.questionText.textContent = `${ratio}(${angleLabel})`;
      els.answerInput.value = "";
      els.answerInput.focus();
      els.answerKey.textContent = "";
      setFeedback("", "neutral");
    }

    function setFeedback(message, type) {
      els.feedback.textContent = message;
      els.feedback.className = `feedback ${type}`;
    }

    function updateStats() {
      els.correctCount.textContent = String(state.correct);
      els.attemptCount.textContent = String(state.attempts);
      els.streakCount.textContent = String(state.streak);
    }

    function parseUserAnswer(raw) {
      const text = raw.trim();
      if (!text) return { kind: "blank" };

      if (/^(undefined|undef|dne|no\s*solution|infinity|infinite|∞)$/i.test(text)) {
        return { kind: "undefined" };
      }

      let expr = text.toLowerCase();
      expr = expr.replace(/\s+/g, "");
      expr = expr.replace(/−/g, "-");
      expr = expr.replace(/√/g, "sqrt");
      expr = expr.replace(/sqrt([23])/g, "sqrt($1)");
      expr = expr.replace(/(\d)(sqrt|\()/g, "$1*$2");
      expr = expr.replace(/\)(\d|sqrt|\()/g, ")*$1");

      if (!/^[0-9+\-*/().sqrt]+$/.test(expr)) {
        return { kind: "invalid" };
      }

      const withoutSqrt = expr.replace(/sqrt/g, "");
      if (/[a-rt-z]/i.test(withoutSqrt)) {
        return { kind: "invalid" };
      }

      try {
        const value = Function(`"use strict"; const sqrt = Math.sqrt; return (${expr});`)();
        if (typeof value !== "number" || !Number.isFinite(value)) {
          return { kind: "invalid" };
        }
        return { kind: "number", value };
      } catch {
        return { kind: "invalid" };
      }
    }

    function checkAnswer() {
      if (!state.question) return;

      const parsed = parseUserAnswer(els.answerInput.value);
      if (parsed.kind === "blank") {
        setFeedback("Enter an answer first.", "bad");
        return;
      }

      state.attempts += 1;

      let isCorrect = false;
      if (state.question.canonical === "undefined") {
        isCorrect = parsed.kind === "undefined";
      } else if (parsed.kind === "number") {
        isCorrect = Math.abs(parsed.value - state.question.answerNumber) < 1e-6;
      }

      if (isCorrect) {
        state.correct += 1;
        state.streak += 1;
        setFeedback("Correct.", "ok");
        els.answerKey.textContent = "";
      } else {
        state.streak = 0;
        setFeedback("Not quite. Try again or reveal the answer.", "bad");
      }

      updateStats();
    }

    function showAnswer() {
      if (!state.question) return;

      const exact = state.question.canonical;
      const decimal = exact === "undefined" ? "" : ` (${state.question.answerNumber.toFixed(4)})`;
      els.answerKey.textContent = `Answer: ${exact}${decimal}`;
      state.streak = 0;
      updateStats();
      setFeedback("Answer revealed. Click Next for a new problem.", "neutral");
    }

    function buildRatioControls() {
      els.ratioChoices.innerHTML = "";
      for (const ratio of ratios) {
        const label = document.createElement("label");
        label.className = "choice";

        const input = document.createElement("input");
        input.type = "checkbox";
        input.name = "ratio";
        input.value = ratio;
        input.checked = true;

        input.addEventListener("change", () => {
          if (!getSelectedRatios().length) {
            setFeedback("Choose at least one ratio.", "bad");
          }
          createQuestion();
        });

        label.appendChild(input);
        label.append(` ${ratio}`);
        els.ratioChoices.appendChild(label);
      }
    }

    function setupListeners() {
      els.checkBtn.addEventListener("click", checkAnswer);
      els.showBtn.addEventListener("click", showAnswer);
      els.nextBtn.addEventListener("click", createQuestion);
      els.answerInput.addEventListener("keydown", (event) => {
        if (event.key === "Enter") checkAnswer();
      });

      document.querySelectorAll('input[name="unit"]').forEach((input) => {
        input.addEventListener("change", createQuestion);
      });

      els.extendedToggle.addEventListener("change", createQuestion);
    }

    buildRatioControls();
    setupListeners();
    updateStats();
    createQuestion();
  </script>
</body>
</html>
