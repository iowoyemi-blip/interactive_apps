<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Radian Bridge - Mastery Levels</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .arc-path {
            transition: d 0.6s ease-out;
            stroke-linecap: round;
        }

        .input-btn {
            @apply px-2 py-4 bg-white border border-slate-200 rounded-xl hover:bg-slate-50 active:scale-95 transition-all font-bold text-slate-700 shadow-sm text-lg;
        }

        .correct-flash {
            animation: flashGreen 0.5s ease;
        }

        @keyframes flashGreen {
            0% { background-color: transparent; }
            50% { background-color: rgba(16, 185, 129, 0.2); }
            100% { background-color: transparent; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }
        .shake { animation: shake 0.4s ease-in-out; }

        .benchmark-line {
            stroke-dasharray: 4;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 md:p-8">

    <div class="max-w-4xl w-full">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-black text-slate-900 tracking-tight">Radian <span class="text-emerald-600">Bridge</span></h1>
                <p class="text-slate-500 text-sm font-medium">Master the degree-to-radian shift.</p>
            </div>
            
            <div id="game-stats" class="hidden flex gap-3">
                <div id="stat-streak-box" class="bg-white px-5 py-3 rounded-2xl shadow-sm border border-slate-100 flex flex-col items-center min-w-[100px]">
                    <span id="stat-label" class="text-[10px] uppercase font-black text-slate-400 mb-1">Streak</span>
                    <span id="score-val" class="text-2xl font-mono font-bold text-emerald-600">0</span>
                </div>
                <div id="stat-timer-box" class="hidden bg-white px-5 py-3 rounded-2xl shadow-sm border border-slate-100 flex flex-col items-center min-w-[80px]">
                    <span class="text-[10px] uppercase font-black text-slate-400 mb-1">Time</span>
                    <span id="timer-val" class="text-2xl font-mono font-bold text-blue-600">60s</span>
                </div>
                <button onclick="backToMenu()" class="p-4 bg-white border border-slate-100 shadow-sm hover:bg-slate-50 rounded-2xl text-slate-500 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                </button>
            </div>
        </header>

        <!-- Menu Screen -->
        <div id="menu-screen" class="max-w-4xl mx-auto mt-6 fade-in">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold text-slate-800">Choose Practice Mode</h2>
                <p class="text-slate-500 mt-2">Progression from visualization to automaticity.</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Level 1 -->
                <button onclick="startGame('visual')" class="group bg-white p-6 rounded-[32px] border-4 border-transparent hover:border-emerald-500 shadow-xl transition-all text-left flex flex-col h-full">
                    <div class="w-10 h-10 bg-emerald-100 rounded-xl flex items-center justify-center text-emerald-600 mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"></path></svg>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800">1. Scaffolded</h3>
                    <p class="text-slate-500 text-xs mt-2 leading-relaxed flex-grow">Visual arc length and quadrant hints provided.</p>
                    <div class="mt-4 text-emerald-600 font-bold text-[10px] uppercase tracking-widest">Start Level →</div>
                </button>

                <!-- Level 2 -->
                <button onclick="startGame('mental')" class="group bg-white p-6 rounded-[32px] border-4 border-transparent hover:border-blue-500 shadow-xl transition-all text-left flex flex-col h-full">
                    <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center text-blue-600 mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800">2. Mental Recall</h3>
                    <p class="text-slate-500 text-xs mt-2 leading-relaxed flex-grow">Visual aids removed. Focus on benchmark logic.</p>
                    <div class="mt-4 text-blue-600 font-bold text-[10px] uppercase tracking-widest">Start Level →</div>
                </button>

                <!-- Level 3 -->
                <button onclick="startGame('timed')" class="group bg-white p-6 rounded-[32px] border-4 border-transparent hover:border-orange-500 shadow-xl transition-all text-left flex flex-col h-full">
                    <div class="w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center text-orange-600 mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800">3. Minute Mode</h3>
                    <p class="text-slate-500 text-xs mt-2 leading-relaxed flex-grow">60-second challenge. How many can you get?</p>
                    <div class="mt-4 text-orange-600 font-bold text-[10px] uppercase tracking-widest">Start Challenge →</div>
                </button>
            </div>

            <div class="mt-10 flex justify-center gap-8">
                <div class="text-center">
                    <div class="text-[10px] font-black uppercase text-slate-400">Best Streak</div>
                    <div id="menu-best-streak" class="text-xl font-bold text-emerald-600">0</div>
                </div>
                <div class="text-center border-l border-slate-200 pl-8">
                    <div class="text-[10px] font-black uppercase text-slate-400">Minute High Score</div>
                    <div id="menu-best-timed" class="text-xl font-bold text-orange-600">0</div>
                </div>
            </div>
        </div>

        <!-- Practice Mode -->
        <div id="practice-screen" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-8 items-start fade-in">
            <div id="viz-card" class="bg-white p-8 rounded-[40px] shadow-xl border border-slate-100 flex flex-col items-center justify-center relative min-h-[480px]">
                <div id="flash-overlay" class="absolute inset-0 pointer-events-none rounded-[40px]"></div>
                
                <svg viewBox="-120 -120 240 240" class="w-full max-w-[260px]">
                    <circle cx="0" cy="0" r="100" fill="none" stroke="#f1f5f9" stroke-width="8" />
                    <line x1="-110" y1="0" x2="110" y2="0" stroke="#cbd5e1" stroke-width="1" class="benchmark-line" />
                    <line x1="0" y1="-110" x2="0" y2="110" stroke="#cbd5e1" stroke-width="1" class="benchmark-line" />
                    <text x="-118" y="5" font-size="10" font-weight="bold" fill="#94a3b8">π</text>
                    <text x="110" y="5" font-size="10" font-weight="bold" fill="#94a3b8">2π</text>
                    <path id="radian-arc" d="" fill="none" stroke="#10b981" stroke-width="8" class="arc-path" />
                    <circle id="end-point" cx="100" cy="0" r="6" fill="#059669" style="display:none;" />
                </svg>

                <div class="mt-6 text-center">
                    <div id="degree-display" class="text-6xl font-black text-slate-900 mb-2">0°</div>
                    <div id="logic-hint-container" class="h-10 flex items-center justify-center">
                        <div id="logic-hint" class="bg-emerald-50 text-emerald-700 px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider opacity-0 transition-opacity">
                            Hint: Just past π
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex flex-col gap-4">
                <div class="bg-white p-8 rounded-[40px] shadow-xl border border-slate-100">
                    <div class="mb-6 relative">
                        <input type="text" id="answer-input" readonly
                            class="w-full text-center text-4xl font-mono p-6 bg-slate-50 border-4 border-slate-100 rounded-3xl text-slate-800 placeholder-slate-200"
                            placeholder="? π / ?">
                        <div id="feedback-msg" class="absolute -bottom-6 left-0 right-0 text-center text-xs font-bold uppercase tracking-widest text-slate-400"></div>
                    </div>

                    <div class="grid grid-cols-4 gap-3">
                        <button class="input-btn" onclick="press('1')">1</button>
                        <button class="input-btn" onclick="press('2')">2</button>
                        <button class="input-btn" onclick="press('3')">3</button>
                        <button class="input-btn bg-slate-50" onclick="backspace()">⌫</button>
                        <button class="input-btn" onclick="press('4')">4</button>
                        <button class="input-btn" onclick="press('5')">5</button>
                        <button class="input-btn" onclick="press('6')">6</button>
                        <button class="input-btn text-emerald-600" onclick="press('π')">π</button>
                        <button class="input-btn" onclick="press('7')">7</button>
                        <button class="input-btn" onclick="press('8')">8</button>
                        <button class="input-btn" onclick="press('9')">9</button>
                        <button class="input-btn text-blue-500" onclick="press('/')">/</button>
                        <button class="input-btn" onclick="press('0')">0</button>
                        <button id="check-btn" class="input-btn col-span-3 bg-emerald-600 text-white hover:bg-emerald-700" onclick="checkAnswer()">CHECK</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Result Modal -->
        <div id="result-modal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-[40px] p-10 max-w-sm w-full text-center shadow-2xl">
                <h2 class="text-3xl font-black text-slate-900 mb-2">Time's Up!</h2>
                <p class="text-slate-500 mb-6">Mastery Minute Results</p>
                <div class="text-6xl font-black text-orange-600 mb-8" id="modal-score">0</div>
                <div class="space-y-3">
                    <button onclick="startGame('timed')" class="w-full py-4 bg-orange-600 text-white rounded-2xl font-bold shadow-lg shadow-orange-200">Try Again</button>
                    <button onclick="backToMenu()" class="w-full py-4 bg-slate-100 text-slate-600 rounded-2xl font-bold">Back to Menu</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const PROBLEMS = [
            { deg: 30, ans: "π/6", hint: "Q1: 1/6 of π" },
            { deg: 45, ans: "π/4", hint: "Q1: 1/4 of π" },
            { deg: 60, ans: "π/3", hint: "Q1: 1/3 of π" },
            { deg: 120, ans: "2π/3", hint: "Q2: Short of π (3/3)" },
            { deg: 135, ans: "3π/4", hint: "Q2: Short of π (4/4)" },
            { deg: 150, ans: "5π/6", hint: "Q2: Short of π (6/6)" },
            { deg: 210, ans: "7π/6", hint: "Q3: Past π (6/6)" },
            { deg: 225, ans: "5π/4", hint: "Q3: Past π (4/4)" },
            { deg: 240, ans: "4π/3", hint: "Q3: Past π (3/3)" },
            { deg: 300, ans: "5π/3", hint: "Q4: Short of 2π (6/3)" },
            { deg: 315, ans: "7π/4", hint: "Q4: Short of 2π (8/4)" },
            { deg: 330, ans: "11π/6", hint: "Q4: Short of 2π (12/6)" }
        ];

        let state = {
            mode: 'visual',
            isGameActive: false,
            score: 0,
            timeLeft: 60,
            timerId: null,
            currentProb: null,
            bestStreak: parseInt(localStorage.getItem('unitCircleBestStreak')) || 0,
            bestTimed: parseInt(localStorage.getItem('unitCircleBestTimed')) || 0
        };

        const els = {
            scoreVal: document.getElementById('score-val'),
            timerVal: document.getElementById('timer-val'),
            timerBox: document.getElementById('stat-timer-box'),
            statLabel: document.getElementById('stat-label'),
            degree: document.getElementById('degree-display'),
            hint: document.getElementById('logic-hint'),
            input: document.getElementById('answer-input'),
            arc: document.getElementById('radian-arc'),
            point: document.getElementById('end-point'),
            feedback: document.getElementById('feedback-msg'),
            flash: document.getElementById('flash-overlay'),
            vizCard: document.getElementById('viz-card'),
            menu: document.getElementById('menu-screen'),
            practice: document.getElementById('practice-screen'),
            stats: document.getElementById('game-stats'),
            modal: document.getElementById('result-modal'),
            modalScore: document.getElementById('modal-score'),
            menuBestStreak: document.getElementById('menu-best-streak'),
            menuBestTimed: document.getElementById('menu-best-timed')
        };

        function updateHighScoresDisplay() {
            els.menuBestStreak.innerText = state.bestStreak;
            els.menuBestTimed.innerText = state.bestTimed;
        }
        updateHighScoresDisplay();

        function polarToCartesian(radius, deg) {
            const rad = deg * Math.PI / 180.0;
            return { x: radius * Math.cos(rad), y: -radius * Math.sin(rad) };
        }

        function describeArc(radius, start, end) {
            const s = polarToCartesian(radius, start);
            const e = polarToCartesian(radius, end);
            const large = end - start <= 180 ? "0" : "1";
            return ["M", s.x, s.y, "A", radius, radius, 0, large, 0, e.x, e.y].join(" ");
        }

        function generateProblem() {
            state.currentProb = PROBLEMS[Math.floor(Math.random() * PROBLEMS.length)];
            els.degree.innerText = state.currentProb.deg + "°";
            els.hint.innerText = state.currentProb.hint;
            els.hint.style.opacity = (state.mode === 'visual') ? "1" : "0";
            els.input.value = "";
            els.feedback.innerText = "Target: " + state.currentProb.deg + "°";
            
            if (state.mode === 'visual') {
                els.arc.setAttribute("d", describeArc(100, 0, state.currentProb.deg));
                const pos = polarToCartesian(100, state.currentProb.deg);
                els.point.setAttribute("cx", pos.x);
                els.point.setAttribute("cy", pos.y);
                els.point.style.display = "block";
            } else {
                els.arc.setAttribute("d", "");
                els.point.style.display = "none";
            }
        }

        function checkAnswer() {
            if (!state.isGameActive) return;
            const user = els.input.value.trim().toLowerCase().replace('pi', 'π').replace(/^1π/, 'π');
            const correct = state.currentProb.ans.replace(/^1π/, 'π');

            if (user === correct) {
                state.score++;
                els.scoreVal.innerText = state.score;
                els.flash.classList.add('correct-flash');
                els.feedback.innerText = "✓ CORRECT";
                els.feedback.classList.replace('text-slate-400', 'text-emerald-500');
                
                if (state.mode !== 'timed' && state.score > state.bestStreak) {
                    state.bestStreak = state.score;
                    localStorage.setItem('unitCircleBestStreak', state.bestStreak);
                }

                setTimeout(() => {
                    els.flash.classList.remove('correct-flash');
                    els.feedback.classList.replace('text-emerald-500', 'text-slate-400');
                    generateProblem();
                }, 500);
            } else {
                if (state.mode !== 'timed') {
                    state.score = 0;
                    els.scoreVal.innerText = 0;
                }
                els.vizCard.classList.add('shake');
                els.feedback.innerText = "Try again!";
                els.feedback.classList.replace('text-slate-400', 'text-red-500');
                setTimeout(() => {
                    els.vizCard.classList.remove('shake');
                    els.feedback.classList.replace('text-red-500', 'text-slate-400');
                    els.input.value = "";
                }, 400);
            }
        }

        function startGame(mode) {
            state.mode = mode;
            state.isGameActive = true;
            state.score = 0;
            els.scoreVal.innerText = 0;
            els.modal.classList.add('hidden');
            
            els.menu.classList.add('hidden');
            els.practice.classList.remove('hidden');
            els.stats.classList.remove('hidden');

            if (mode === 'timed') {
                state.timeLeft = 60;
                els.timerVal.innerText = "60s";
                els.timerBox.classList.remove('hidden');
                els.statLabel.innerText = "Score";
                state.timerId = setInterval(() => {
                    state.timeLeft--;
                    els.timerVal.innerText = state.timeLeft + "s";
                    if (state.timeLeft <= 0) endGame();
                }, 1000);
            } else {
                els.timerBox.classList.add('hidden');
                els.statLabel.innerText = "Streak";
            }
            generateProblem();
        }

        function endGame() {
            clearInterval(state.timerId);
            state.isGameActive = false;
            els.modalScore.innerText = state.score;
            els.modal.classList.remove('hidden');
            if (state.score > state.bestTimed) {
                state.bestTimed = state.score;
                localStorage.setItem('unitCircleBestTimed', state.bestTimed);
            }
            updateHighScoresDisplay();
        }

        function backToMenu() {
            clearInterval(state.timerId);
            state.isGameActive = false;
            els.menu.classList.remove('hidden');
            els.practice.classList.add('hidden');
            els.stats.classList.add('hidden');
            els.modal.classList.add('hidden');
            updateHighScoresDisplay();
        }

        function press(v) { if(state.isGameActive) els.input.value += v; }
        function backspace() { els.input.value = els.input.value.slice(0, -1); }

        window.addEventListener('keydown', (e) => {
            if (!state.isGameActive) return;
            if (e.key >= '0' && e.key <= '9') press(e.key);
            if (e.key === 'p') press('π');
            if (e.key === '/' || e.key === 'f') press('/');
            if (e.key === 'Backspace') backspace();
            if (e.key === 'Enter') checkAnswer();
        });
    </script>
</body>
</html>